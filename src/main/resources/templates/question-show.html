<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title th:text="${question.title}">Question Details</title>
    <link rel="stylesheet" href="https://uicdn.toast.com/editor/latest/toastui-editor.min.css" />
    <th:block th:replace="~{fragments/layout :: styles}"></th:block>

    <style>
        /* ===== Layout fixes for fixed navbar overlap ===== */
        :root {
          /* Set this to your actual navbar height on desktop */
          --header-h: 64px;
          --page-max: 1264px;
          --gap: 24px;
        }

        /* If your site/header uses fixed positioning, ensure it sits on top */
        .site-header,
        .navbar {
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          z-index: 1000;
        }

        /* Push the entire page below the fixed header */
        .page-wrapper,
        .page-container {
          max-width: var(--page-max);
          margin: 0 auto;
          padding: calc(var(--gap)) 12px;
          padding-top: calc(var(--header-h) + var(--gap));
          box-sizing: border-box;
        }

        /* Main two-column layout */
        .question-container {
          display: flex;
          gap: var(--gap);
        }

        .main-content {
          flex: 1;
          min-width: 0;
        }

        .sidebar {
          width: 300px;
          flex: 0 0 300px;
          /* Offset the sidebar content as well so its first card isn't hidden */
          padding-top: 8px;
          position: sticky;
          top: calc(var(--header-h) + 8px);
          height: fit-content;
        }

        /* Typography and blocks */
        .question-header {
          display: flex;
          justify-content: space-between;
          align-items: flex-start;
          margin-bottom: 8px;
          padding-bottom: 8px;
        }

        .question-title {
          font-size: 27px;
          font-weight: 400;
          line-height: 1.35;
          margin: 0 0 8px 0;
          color: #3b4045;
        }

        .question-meta {
          display: flex;
          gap: 16px;
          font-size: 13px;
          color: #6a737c;
          padding: 8px 0;
          border-bottom: 1px solid #e3e6e8;
          margin-bottom: 16px;
        }

        .question-body img,
        .answer-body img {
          max-width: 100%;
          max-height: 500px;
          width: auto;
          height: auto;
          display: block;
          margin: 15px 0;
          object-fit: contain;
          border-radius: 4px;
        }

        .post-actions {
          display: flex;
          gap: 12px;
          align-items: center;
          margin: 12px 0 20px 0;
        }

        .answers-header {
          font-size: 21px;
          margin: 24px 0 12px 0;
        }

        .answer {
          border-top: 1px solid #e3e6e8;
          padding-top: 16px;
          margin-top: 16px;
        }

        .tag-list {
          display: flex;
          flex-wrap: wrap;
          gap: 8px;
          margin: 16px 0;
        }

        .tag {
          background: #e1ecf4;
          color: #39739d;
          border: 1px solid #cde9fe;
          padding: 4px 6px;
          font-size: 12px;
          border-radius: 3px;
        }

        /* Cards, including the “Steps to write a good question” panel */
        .card {
          border: 1px solid #e3e6e8;
          border-radius: 6px;
          background: #fff;
          padding: 12px;
          margin-bottom: 16px;
          box-shadow: 0 1px 2px rgba(0,0,0,0.02);
        }

        .card h4 {
          margin: 0 0 8px 0;
          font-size: 15px;
        }

        .card ul {
          padding-left: 18px;
          margin: 0;
        }

        .card li {
          margin: 6px 0;
          line-height: 1.4;
          color: #3b4045;
          font-size: 13px;
        }

        /* Mobile/tablet adjustments: many headers grow on mobile */
        @media (max-width: 980px) {
          :root {
            --header-h: 72px; /* if your mobile header is taller */
          }

          .question-container {
            flex-direction: column;
          }

          .sidebar {
            width: auto;
            flex: none;
            position: static; /* drop sticky on small screens if needed */
            top: auto;
            padding-top: 0;
          }
        }

        @media (max-width: 640px) {
          :root {
            --header-h: 88px; /* bump for very small screens if navbar wraps */
          }
        }
    </style>
</head>
<body>
<div th:replace="~{fragments/layout :: navbar}"></div>
<div th:replace="~{fragments/layout :: sidebar}"></div>

<div class="page-wrapper">
    <div class="question-container">
        <div class="question-main">
            <div class="question-header">
                <h1 class="question-title" th:text="${question.title}">Question Title</h1>
            </div>

            <div class="question-meta">
                    <span>
                        <strong>Asked</strong>
                        <time th:text="${#temporals.format(question.createdAt, 'MM dd, yyyy')}">today</time>
                    </span>
                <span>
                        <strong>Modified</strong>
                        <time th:text="${#temporals.format(question.updatedAt, 'MM dd, yyyy')}">today</time>
                    </span>
                <span>
                        <strong>Viewed</strong>
                        <span th:text="${question.viewCount} + ' times'">7 times</span>
                    </span>
            </div>

            <div class="question-body">
                <div class="vote-cell">
                    <form th:action="@{/questions/vote/{id}(id=${question.id})}" method="post">
                        <input type="hidden" name="choice" value="upvote" />
                        <button type="submit" class="vote-button" title="This question is useful">
                            <svg aria-hidden="true" width="36" height="36" viewBox="0 0 36 36"><path d="M2 25h32L18 9 2 25Z"/></svg>
                        </button>
                    </form>

                    <div class="vote-count" th:text="${question.score}">1</div>

                    <form th:action="@{/questions/vote/{id}(id=${question.id})}" method="post">
                        <input type="hidden" name="choice" value="downvote" />
                        <button type="submit" class="vote-button" title="This question is not useful">
                            <svg aria-hidden="true" width="36" height="36" viewBox="0 0 36 36"><path d="M2 11h32L18 27 2 11Z"/></svg>
                        </button>
                    </form>
                </div>

                <div class="post-layout">
                    <div class="post-content" th:utext="${questionHtml}">
                        Question content goes here...
                    </div>

                    <div class="post-tags">
                        <a th:each="tag : ${question.tags}"
                           th:href="@{/tags/{tagName}(tagName=${tag.name})}"
                           th:text="${tag.name}"
                           class="post-tag">
                        </a>
                    </div>

                    <div class="post-signature">
                        <div class="user-info">
                            <div class="user-action-time">
                                asked <time th:text="${#temporals.format(question.createdAt, 'MM dd, yyyy')}">Oct 23, 2025</time>
                            </div>
                            <div class="user-details">
                                <div class="user-avatar" th:text="${question.authorName.substring(0,1).toUpperCase()}">U</div>
                                <div>
                                    <a href="#" class="user-name" th:text="${question.authorName}">User Name</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="answers-header">
                <h2>Answers</h2>
            </div>

            <!-- Answers will be listed here -->

            <div class="answer-form">
                <h3>Your Answer</h3>
                <form th:action="@{/answers/new}" method="post" onsubmit="prepareNewAnswerContent()">
                    <input type="hidden" name="questionId" th:value="${question.id}" />
                    <div id="new-answer-editor"></div>
                    <input type="hidden" name="content" id="newAnswerContent" />
                    <button type="submit" class="submit-button">Post Your Answer</button>
                </form>
            </div>
        </div>

        <aside class="sidebar">
            <div class="sidebar-widget">
                <h3>The Overflow Blog</h3>
                <ul>
                    <li>→ Featured on Meta</li>
                    <li>→ Community asks</li>
                </ul>
            </div>
        </aside>
    </div>
</div>

<div th:replace="~{fragments/layout :: footer}"></div>

<script src="https://uicdn.toast.com/editor/latest/toastui-editor-all.min.js"></script>
<script>
    const newAnswerEditor = new toastui.Editor({
        el: document.querySelector('#new-answer-editor'),
        height: '300px',
        initialEditType: 'markdown',
        previewStyle: 'vertical',
        placeholder: 'Write your answer here...'
    });

    function prepareNewAnswerContent(){
        document.getElementById('newAnswerContent').value = newAnswerEditor.getMarkdown();
        return true;
    }
</script>
</body>
</html>
