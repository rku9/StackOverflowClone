<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
</head>
<body>

<!-- Navbar Fragment -->
<nav th:fragment="navbar"
     style="background: #f8f9f9; border-bottom: 1px solid #d6d9dc; padding: 8px 0; position: fixed; top: 0; left: 0; right: 0; z-index: 100;">
    <div style="max-width: 1264px; margin: 0 auto; display: flex; align-items: center; gap: 16px; padding: 0 16px;">
        <!-- Logo -->
        <a href="/questions" style="text-decoration: none;">
            <div style="display: flex; align-items: center; gap: 8px;">
                <span style="font-size: 20px; font-weight: 700; color: #232629;">stack</span>
                <span style="font-size: 20px; font-weight: 700; color: #f48024;">overflow</span>
            </div>
        </a>

        <!-- Search Container -->
        <div style="flex: 1; max-width: 600px; position: relative;">
            <div id="searchContainer" style="position: relative;">
                <input type="text"
                       id="globalSearchInput"
                       placeholder="Search..."
                       style="width: 100%; padding: 8px 40px 8px 32px; border: 1px solid #babfc4; border-radius: 3px; font-size: 13px;"
                       onfocus="showSearchDropdown()"
                       onblur="hideSearchDropdown()">
                <svg style="position: absolute; left: 8px; top: 50%; transform: translateY(-50%);" width="18"
                     height="18" viewBox="0 0 18 18" fill="#6a737c">
                    <path d="M12.86 11.32l4.38 4.38-1.54 1.54-4.38-4.38a7 7 0 1 1 1.54-1.54zM7 12A5 5 0 1 0 7 2a5 5 0 0 0 0 10z"/>
                </svg>
                <button onclick="performSearch()"
                        style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); background: transparent; border: none; cursor: pointer; padding: 4px; color: #6a737c;">
                    â†µ
                </button>
            </div>

            <!-- Search Dropdown -->
            <div id="searchDropdown"
                 style="display: none; position: absolute; top: 100%; left: 0; right: 0; background: white; border: 1px solid #d6d9dc; border-top: none; border-radius: 0 0 3px 3px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); margin-top: -1px; z-index: 1000;">
                <div style="padding: 12px 16px; border-bottom: 1px solid #e3e6e8;">
                    <div style="font-size: 12px; color: #6a737c; margin-bottom: 8px;">Search syntax</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 12px;">
                        <div>
                            <code style="background: #e3e6e8; padding: 2px 4px; border-radius: 2px;">[tag]</code>
                            <span style="color: #6a737c;">search within a tag</span>
                        </div>
                        <div>
                            <code style="background: #e3e6e8; padding: 2px 4px; border-radius: 2px;">answers:0</code>
                            <span style="color: #6a737c;">unanswered questions</span>
                        </div>
                        <div>
                            <code style="background: #e3e6e8; padding: 2px 4px; border-radius: 2px;">user:1234</code>
                            <span style="color: #6a737c;">search by author</span>
                        </div>
                        <div>
                            <code style="background: #e3e6e8; padding: 2px 4px; border-radius: 2px;">score:3</code>
                            <span style="color: #6a737c;">posts with a 3+ score</span>
                        </div>
                        <div>
                            <code style="background: #e3e6e8; padding: 2px 4px; border-radius: 2px;">"words here"</code>
                            <span style="color: #6a737c;">exact phrase</span>
                        </div>
                        <div>
                            <code style="background: #e3e6e8; padding: 2px 4px; border-radius: 2px;">isaccepted:yes</code>
                            <span style="color: #6a737c;">has accepted answer</span>
                        </div>
                    </div>
                </div>
                <div style="padding: 12px 16px;">
                    <button onclick="performSearch()"
                            style="background: #0a95ff; color: white; border: none; padding: 8px 12px; border-radius: 3px; font-size: 13px; cursor: pointer; width: 100%;">
                        Search
                    </button>
                </div>
            </div>
        </div>

        <!-- Right Side Navigation -->
        <div style="display: flex; gap: 12px; align-items: center;">
            <a href="#" style="color: #6a737c; text-decoration: none; font-size: 13px;">Products</a>

            <!-- Show only when NOT authenticated -->
            <div sec:authorize="isAnonymous()" style="display: flex; gap: 12px; align-items: center;">
                <a href="/login"
                   style="color: #0074cc; text-decoration: none; font-size: 13px; padding: 6px 12px; border-radius: 3px;">Log in</a>
                <a href="/signup"
                   style="background: #0a95ff; color: white; text-decoration: none; font-size: 13px; padding: 8px 12px; border-radius: 4px;">Sign up</a>
            </div>

            <!-- Show only when authenticated -->
            <div sec:authorize="isAuthenticated()" style="display: flex; gap: 12px; align-items: center;">
                <a th:href="@{/users/{userId}(userId=${#authentication.principal.id})}"
                   style="text-decoration: none; color: #3b4045; font-size: 13px; transition: color 0.2s;"
                   onmouseover="this.style.color='#0074cc'"
                   onmouseout="this.style.color='#3b4045'"
                   th:text="${#authentication.principal.displayName}">User</a>
                <form th:action="@{/logout}" method="post" style="display:inline; margin:0;">
                    <button type="submit"
                            style="background: transparent; color: #6a737c; border: 1px solid #d6d9dc; padding: 6px 12px; border-radius: 3px; font-size: 13px; cursor: pointer;">
                        Log out
                    </button>
                </form>
            </div>
        </div>
    </div>
</nav>

<!-- Navbar Script (MUST be included on every page) -->
<script th:fragment="navbar-script">
    let searchDropdownTimeout;

    function showSearchDropdown() {
        clearTimeout(searchDropdownTimeout);
        const dropdown = document.getElementById('searchDropdown');
        if (dropdown) {
            dropdown.style.display = 'block';
        }
    }

    function hideSearchDropdown() {
        searchDropdownTimeout = setTimeout(() => {
            const dropdown = document.getElementById('searchDropdown');
            if (dropdown) {
                dropdown.style.display = 'none';
            }
        }, 200);
    }

    function performSearch() {
        const searchInput = document.getElementById('globalSearchInput');
        if (!searchInput) {
            console.error('Search input not found');
            return;
        }

        const searchQuery = searchInput.value.trim();

        if (searchQuery) {
            // Always redirect to questions page with search query
            window.location.href = '/questions?q=' + encodeURIComponent(searchQuery);
        }
    }

    // Initialize search functionality when DOM is ready
    document.addEventListener('DOMContentLoaded', function () {
        const searchInput = document.getElementById('globalSearchInput');

        if (searchInput) {
            // Populate search input with current 'q' parameter if it exists
            const urlParams = new URLSearchParams(window.location.search);
            const currentQuery = urlParams.get('q');
            if (currentQuery) {
                searchInput.value = currentQuery;
            }

            // Allow Enter key to search
            searchInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    performSearch();
                }
            });
        }
    });
</script>

<!-- Left Sidebar Fragment -->
<aside th:fragment="sidebar" class="left-sidebar">
    <nav class="sidebar-nav">
        <ul class="nav-list">
            <li>
                <a href="/questions" class="nav-item">
                    <svg width="18" height="18" viewBox="0 0 18 18">
                        <path d="M9 1L2 7v9h5V9h4v7h5V7L9 1z" fill="currentColor"/>
                    </svg>
                    <span>Home</span>
                    <span class="badge-new">NEW</span>
                </a>
            </li>
            <li>
                <a href="/questions" class="nav-item active">
                    <svg width="18" height="18" viewBox="0 0 18 18">
                        <circle cx="9" cy="9" r="8" fill="none" stroke="currentColor" stroke-width="2"/>
                        <circle cx="9" cy="9" r="2" fill="currentColor"/>
                    </svg>
                    <span>Questions</span>
                </a>
            </li>
            <li>
                <a href="/tags" class="nav-item">
                    <svg width="18" height="18" viewBox="0 0 18 18">
                        <path d="M2 2l6-2 8 8-6 6-8-8V2z" fill="currentColor"/>
                        <circle cx="5" cy="5" r="1.5" fill="#fff"/>
                    </svg>
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="#" class="nav-item">
                    <svg width="18" height="18" viewBox="0 0 18 18">
                        <path d="M3 2h12v16l-6-4-6 4V2z" fill="currentColor"/>
                    </svg>
                    <span>Saves</span>
                </a>
            </li>
        </ul>

        <div class="nav-separator"></div>

        <ul class="nav-list">
            <li>
                <a href="#" class="nav-item">
                    <svg width="18" height="18" viewBox="0 0 18 18">
                        <path d="M2 9l7-7 7 7M3 10l6-6 6 6" fill="none" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    <span>Challenges</span>
                </a>
            </li>
            <li>
                <a href="#" class="nav-item">
                    <svg width="18" height="18" viewBox="0 0 18 18">
                        <rect x="2" y="4" width="14" height="10" rx="2" fill="currentColor"/>
                        <path d="M5 7h8M5 10h5" stroke="#fff" stroke-width="1.5"/>
                    </svg>
                    <span>Chat</span>
                </a>
            </li>
            <li>
                <a href="#" class="nav-item">
                    <svg width="18" height="18" viewBox="0 0 18 18">
                        <rect x="3" y="2" width="12" height="14" rx="1" fill="currentColor"/>
                        <path d="M6 5h6M6 8h6M6 11h4" stroke="#fff" stroke-width="1"/>
                    </svg>
                    <span>Articles</span>
                </a>
            </li>
            <li>
                <a href="#" class="nav-item">
                    <svg width="18" height="18" viewBox="0 0 18 18">
                        <circle cx="9" cy="6" r="3" fill="currentColor"/>
                        <path d="M3 16c0-3.5 2.5-6 6-6s6 2.5 6 6" fill="currentColor"/>
                    </svg>
                    <span>Users</span>
                </a>
            </li>
            <li>
                <a href="#" class="nav-item">
                    <svg width="18" height="18" viewBox="0 0 18 18">
                        <rect x="2" y="4" width="14" height="12" fill="currentColor"/>
                        <rect x="5" y="7" width="2" height="2" fill="#fff"/>
                        <rect x="8" y="7" width="2" height="2" fill="#fff"/>
                        <rect x="11" y="7" width="2" height="2" fill="#fff"/>
                    </svg>
                    <span>Companies</span>
                </a>
            </li>
        </ul>

        <div class="collectives-section">
            <div class="section-header">
                <span>COLLECTIVES</span>
                <button class="expand-btn">+</button>
            </div>
            <p class="section-description">Communities for your favorite technologies.</p>
        </div>

        <div class="teams-section">
            <div class="section-header">
                <span>TEAMS</span>
                <button class="close-btn">Ã—</button>
            </div>
            <div class="teams-content">
                <div class="teams-icons">
                    <span class="icon">ðŸ“‹</span>
                    <span class="icon">ðŸ’»</span>
                    <span class="icon">âœ“</span>
                </div>
                <p>Ask questions, find answers and collaborate at work with Stack Overflow for Teams.</p>
                <button class="teams-cta">Try Teams for free</button>
            </div>
        </div>
    </nav>
</aside>

<!-- Footer Fragment -->
<footer th:fragment="footer">
    <div class="footer-content">
        <div class="footer-logo">
            <svg aria-hidden="true" class="native svg-icon iconGlyphMd" width="32" height="37" viewBox="0 0 32 37">
                <path fill="#F48024" d="M26 33v-9h4v13H0V24h4v9h22Z"></path>
                <path fill="#BCBBBB" d="m21.5 0-2.7 2 9.9 13.3 2.7-2L21.5 0Z"></path>
                <path fill="#F48024" d="M26 18.4 13.3 7.8l2.1-2.5 12.7 10.6-2.1 2.5Z"></path>
                <path fill="#BCBBBB" d="M9.1 15.2 15 6 6 0 0 9.2l9.1 6Z"></path>
                <path fill="#F48024" d="m19 34-9-6 3-4 9 6-3 4Z"></path>
            </svg>
        </div>
        <div class="footer-section">
            <h5>Stack Overflow</h5>
            <ul>
                <li><a href="#">Questions</a></li>
                <li><a href="#">Help</a></li>
                <li><a href="#">Chat</a></li>
            </ul>
        </div>
        <div class="footer-section">
            <h5>Products</h5>
            <ul>
                <li><a href="#">Teams</a></li>
                <li><a href="#">Advertising</a></li>
                <li><a href="#">Talent</a></li>
            </ul>
        </div>
        <div class="footer-section">
            <h5>Company</h5>
            <ul>
                <li><a href="#">About</a></li>
                <li><a href="#">Press</a></li>
                <li><a href="#">Work Here</a></li>
            </ul>
        </div>
    </div>
    <div class="footer-bottom">
        <div>Site design / logo Â© 2025 Stack Exchange Inc</div>
        <div>user contributions licensed under CC BY-SA</div>
    </div>
</footer>

<!-- Common Styles Fragment -->
<th:block th:fragment="styles">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
            background: #f1f2f3;
            margin: 0;
            position: relative;
        }

        :root {
            --navbar-height: 50px;
        }

        /* Main container */
        .container-fluid {
            max-width: 1264px;
            margin: 0 auto;
            padding: 0 16px;
        }

        /* Flex layout */
        .d-flex.row {
            display: flex;
            justify-content: center;
        }

        /* Sidebars */
        .sidebar-left {
            width: 164px;
            min-width: 164px;
            flex-shrink: 0;
        }

        .sidebar-right {
            width: 300px;
            min-width: 300px;
            flex-shrink: 0;
        }

        /* Center content */
        .content-center {
            max-width: 727px;
            margin: 0 16px;
            flex: 1;
        }

        /* Page wrapper */
        .page-wrapper {
            position: relative;
            margin-left: 164px;
            padding-top: 50px;
            min-height: 100vh;
            max-width: calc(1264px - 164px);
            margin-right: auto;
            padding-left: 24px;
            padding-right: 24px;
        }

        .page-container {
            padding-top: calc(var(--navbar-height) + 20px) !important;
        }

        /* Navbar */
        .navbar {
            background: #f8f9f9;
            border-top: 3px solid #f48225;
            border-bottom: 1px solid #d6d9dc;
            height: 50px;
            display: flex;
            align-items: center;
            padding: 0 12px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }

        .navbar-content {
            max-width: 1264px;
            width: 100%;
            margin: 0 auto;
            display: flex;
            align-items: center;
            gap: 12px;
            padding-left: 164px;
        }

        .logo {
            display: flex;
            align-items: center;
            padding: 0 8px;
            height: 100%;
        }

        .nav-search {
            flex: 1;
            max-width: 700px;
        }

        .nav-search input {
            width: 100%;
            padding: 8px 32px 8px 10px;
            border: 1px solid #babfc4;
            border-radius: 3px;
            font-size: 13px;
        }

        .nav-items {
            display: flex;
            gap: 4px;
            margin-left: auto;
        }

        .nav-btn {
            padding: 8px 10px;
            background: transparent;
            border: none;
            color: #525960;
            font-size: 13px;
            cursor: pointer;
            border-radius: 20px;
        }

        .nav-btn:hover {
            background: #e3e6e8;
        }

        .nav-btn.primary {
            background: #0a95ff;
            color: white;
            border-radius: 3px;
        }

        .nav-btn.primary:hover {
            background: #0074cc;
        }

        /* Left Sidebar */
        .left-sidebar {
            width: 164px;
            background: #f8f9f9;
            border-right: 1px solid #d6d9dc;
            position: absolute;
            top: 50px;
            left: 0;
            min-height: calc(100vh - 50px);
            padding: 24px 0;
            z-index: 100;
        }

        .sidebar-nav {
            font-size: 13px;
        }

        .nav-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 12px 8px 8px;
            color: #525960;
            text-decoration: none;
            border-right: 3px solid transparent;
            transition: all 0.2s;
        }

        .nav-item:hover {
            color: #0c0d0e;
            background: #f1f2f3;
        }

        .nav-item.active {
            background: #f1f2f3;
            color: #0c0d0e;
            font-weight: 700;
            border-right-color: #f48225;
        }

        .nav-item svg {
            flex-shrink: 0;
        }

        .badge-new {
            background: #0a95ff;
            color: white;
            font-size: 10px;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: 600;
            margin-left: auto;
        }

        .nav-separator {
            height: 1px;
            background: #e3e6e8;
            margin: 16px 8px;
        }

        .collectives-section, .teams-section {
            padding: 16px 12px;
            border-top: 1px solid #e3e6e8;
            margin-top: 16px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 11px;
            font-weight: 700;
            color: #6a737c;
            margin-bottom: 8px;
        }

        .expand-btn, .close-btn {
            background: none;
            border: none;
            color: #6a737c;
            font-size: 16px;
            cursor: pointer;
            padding: 0;
            width: 20px;
            height: 20px;
        }

        .section-description {
            font-size: 11px;
            color: #6a737c;
            margin: 4px 0 0 0;
        }

        .teams-section {
            background: #f1f2f3;
            border-radius: 3px;
            margin: 16px 8px 0;
        }

        .teams-content {
            text-align: center;
        }

        .teams-icons {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin: 12px 0;
            font-size: 24px;
        }

        .teams-content p {
            font-size: 11px;
            color: #3b4045;
            margin: 12px 0;
            line-height: 1.4;
        }

        .teams-cta {
            background: #f48225;
            color: white;
            border: none;
            border-radius: 3px;
            padding: 8px 12px;
            font-size: 11px;
            cursor: pointer;
            width: 100%;
            font-weight: 500;
        }

        .teams-cta:hover {
            background: #da6e1c;
        }

        /* Main content area */
        .page-container, .question-container {
            padding-top: 70px;
            padding-left: 12px;
            padding-right: 12px;
        }

        /* Footer */
        footer {
            background: #232629;
            color: #9199a1;
            padding: 32px 12px;
            margin-top: 48px;
            margin-left: -164px;
            width: calc(100% + 164px);
        }

        .footer-content {
            max-width: 1264px;
            margin: 0 auto;
            display: flex;
            gap: 48px;
            flex-wrap: wrap;
        }

        .footer-section h5 {
            color: #babfc4;
            font-size: 13px;
            font-weight: 700;
            margin-bottom: 12px;
            text-transform: uppercase;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section li {
            margin-bottom: 8px;
        }

        .footer-section a {
            color: #9199a1;
            text-decoration: none;
            font-size: 13px;
        }

        .footer-section a:hover {
            color: #e3e6e8;
        }

        .footer-bottom {
            max-width: 1264px;
            margin: 24px auto 0;
            padding-top: 24px;
            border-top: 1px solid #3c4146;
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            flex-wrap: wrap;
            gap: 12px;
        }

        /* Large tablets and below (hide right sidebar) */
        @media screen and (max-width: 1100px) {
            .sidebar-right {
                display: none;
            }

            .content-center {
                max-width: 100%;
            }
        }

        /* Tablets and below (hide left sidebar, adjust layout) */
        @media screen and (max-width: 980px) {
            .left-sidebar {
                display: none;
            }

            .page-wrapper {
                margin-left: 0;
                max-width: 100%;
                padding-left: 16px;
                padding-right: 16px;
            }

            .navbar-content {
                padding-left: 0;
            }

            footer {
                margin-left: 0;
                width: 100%;
            }
        }

        /* Small tablets and large phones */
        @media screen and (max-width: 768px) {
            .navbar-content {
                gap: 8px;
            }

            .nav-search {
                max-width: 400px;
            }

            .nav-btn {
                padding: 6px 8px;
                font-size: 12px;
            }

            .nav-items {
                gap: 2px;
            }

            .page-wrapper {
                padding-left: 12px;
                padding-right: 12px;
            }

            .footer-content {
                flex-direction: column;
                gap: 24px;
            }

            .footer-bottom {
                flex-direction: column;
                text-align: center;
            }
        }

        /* Mobile phones */
        @media screen and (max-width: 640px) {
            .navbar {
                padding: 0 8px;
            }

            .nav-search {
                max-width: 200px;
            }

            .nav-search input {
                font-size: 12px;
                padding: 6px 8px;
            }

            /* Hide some nav buttons on mobile */
            .nav-items .nav-btn:not(.primary) {
                display: none;
            }

            .page-wrapper {
                padding-left: 8px;
                padding-right: 8px;
            }

            .page-container, .question-container {
                padding-left: 8px;
                padding-right: 8px;
            }

            .container-fluid {
                padding: 0 8px;
            }
        }

        /* Extra small phones */
        @media screen and (max-width: 480px) {
            .navbar-content {
                flex-wrap: wrap;
                height: auto;
            }

            .nav-search {
                order: 3;
                max-width: 100%;
                width: 100%;
                margin-top: 8px;
            }

            .logo {
                padding: 0 4px;
            }
        }
    </style>
</th:block>
</body>
</html>
